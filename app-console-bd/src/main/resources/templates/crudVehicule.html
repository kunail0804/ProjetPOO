<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>US.A.1 - CRUD Véhicules</title>
</head>
<body>
  <h2>US.A.1 - Ajouter / Modifier / Supprimer les véhicules</h2>

  <div>
    <label>API Base URL:</label>
    <input id="apiBase" value="http://localhost:8080" />
  </div>

  <hr />

  <div>
    <label>Type:</label>
    <select id="type">
      <option value="voitures">Voiture</option>
      <option value="motos">Moto</option>
      <option value="camions">Camion</option>
    </select>
  </div>

  <h3>Champs communs (Louable + Vehicule)</h3>
  <div><label>id:</label> <input id="id" type="number" /></div>
  <div><label>idProprietaire:</label> <input id="idProprietaire" type="number" /></div>
  <div><label>marque:</label> <input id="marque" /></div>
  <div><label>prixJour:</label> <input id="prixJour" type="number" step="0.01" /></div>
  <div>
    <label>statut:</label>
    <select id="statut">
      <option value="DISPONIBLE">DISPONIBLE</option>
      <option value="INDISPONIBLE">INDISPONIBLE</option>
    </select>
  </div>
  <div><label>lieuPrincipal:</label> <input id="lieuPrincipal" /></div>

  <div><label>modele:</label> <input id="modele" /></div>
  <div><label>annee:</label> <input id="annee" type="number" /></div>
  <div><label>couleur:</label> <input id="couleur" /></div>
  <div><label>immatriculation:</label> <input id="immatriculation" /></div>
  <div><label>kilometrage:</label> <input id="kilometrage" type="number" /></div>

  <h3>Champs spécifiques</h3>

  <div id="voitureFields">
    <h4>Voiture</h4>
    <div><label>nbPortes:</label> <input id="nbPortes" type="number" /></div>
    <div><label>nbPlaces:</label> <input id="nbPlaces" type="number" /></div>
    <div><label>volumeCoffreLitres:</label> <input id="volumeCoffreLitres" type="number" /></div>
    <div><label>boite:</label> <input id="boite" placeholder="MANUELLE" /></div>
    <div><label>carburant:</label> <input id="carburant" placeholder="ESSENCE" /></div>
    <div>
      <label>climatisation:</label>
      <select id="climatisation">
        <option value="">(null)</option>
        <option value="true">true</option>
        <option value="false">false</option>
      </select>
    </div>
  </div>

  <div id="motoFields" style="display:none;">
    <h4>Moto</h4>
    <div><label>cylindreeCc:</label> <input id="cylindreeCc" type="number" /></div>
    <div><label>puissanceCh:</label> <input id="puissanceCh" type="number" /></div>
    <div><label>typeMoto:</label> <input id="typeMoto" placeholder="ROADSTER" /></div>
    <div><label>permisRequis:</label> <input id="permisRequis" placeholder="A2" /></div>
  </div>

  <div id="camionFields" style="display:none;">
    <h4>Camion</h4>
    <div><label>chargeMaxKg:</label> <input id="chargeMaxKg" type="number" /></div>
    <div><label>volumeUtileM3:</label> <input id="volumeUtileM3" type="number" /></div>
    <div><label>hauteurM:</label> <input id="hauteurM" type="number" /></div>
    <div><label>longueurM:</label> <input id="longueurM" type="number" /></div>
    <div><label>permisRequis:</label> <input id="permisRequis" /></div>

  </div>

  <hr />

  <div>
    <button id="btnAdd">Ajouter (POST)</button>
    <button id="btnUpdate">Modifier (PUT)</button>
    <button id="btnDelete">Supprimer (DELETE)</button>
  </div>

  <h3>Preview JSON envoyé</h3>
  <pre id="preview">{}</pre>

  <h3>Résultat</h3>
  <pre id="result">...</pre>

<script>
  const $ = (id) => document.getElementById(id);

  function showFields() {
    const t = $("type").value;
    $("voitureFields").style.display = (t === "voitures") ? "" : "none";
    $("motoFields").style.display = (t === "motos") ? "" : "none";
    $("camionFields").style.display = (t === "camions") ? "" : "none";
    updatePreview();
  }

  function val(id) {
    const v = $(id).value;
    return v === "" ? null : v;
  }
  function num(id) {
    const v = $(id).value;
    return v === "" ? null : Number(v);
  }
  function boolOrNull(id) {
    const v = $(id).value;
    if (v === "") return null;
    return v === "true";
  }

  function buildBody() {
    const type = $("type").value;

    const body = {
      id: num("id"),
      idProprietaire: num("idProprietaire"),
      marque: val("marque"),
      prixJour: num("prixJour"),
      statut: val("statut"),
      lieuPrincipal: val("lieuPrincipal"),

      modele: val("modele"),
      annee: num("annee"),
      couleur: val("couleur"),
      immatriculation: val("immatriculation"),
      kilometrage: num("kilometrage"),
    };

    if (type === "voitures") {
      body.nbPortes = num("nbPortes");
      body.nbPlaces = num("nbPlaces");
      body.volumeCoffreLitres = num("volumeCoffreLitres");
      body.boite = val("boite");
      body.carburant = val("carburant");
      body.climatisation = boolOrNull("climatisation");
    } else if (type === "motos") {
      body.cylindreeCc = num("cylindreeCc");
      body.puissanceCh = num("puissanceCh");
      body.typeMoto = val("typeMoto");
      body.permisRequis = val("permisRequis");
    } else if (type === "camions") {
      body.volumeM3 = num("volumeM3");
    }

    return body;
  }

  function updatePreview() {
    $("preview").textContent = JSON.stringify(buildBody(), null, 2);
  }

  async function callApi(method) {
    const base = $("apiBase").value.replace(/\/+$/, "");
    const type = $("type").value;
    const id = $("id").value;
    const idProprietaire = $("idProprietaire").value;

    let url = `${base}/api/${type}`;
    if (method === "PUT") url += `/${encodeURIComponent(id)}`;
    if (method === "DELETE") url += `/${encodeURIComponent(id)}?idProprietaire=${encodeURIComponent(idProprietaire)}`;

    const options = { method, headers: { "Content-Type": "application/json" } };
    if (method !== "DELETE") options.body = JSON.stringify(buildBody());

    $("result").textContent = `${method} ${url}\n\n...`;

    try {
      const res = await fetch(url, options);
      const text = await res.text();
      $("result").textContent = `${method} ${url}\nStatus: ${res.status}\n\n${text || "(empty)"}`;
    } catch (e) {
      $("result").textContent = `ERROR: ${e.message}`;
    }
  }

  $("type").addEventListener("change", showFields);

  [
    "apiBase","id","idProprietaire","marque","prixJour","statut","lieuPrincipal",
    "modele","annee","couleur","immatriculation","kilometrage",
    "nbPortes","nbPlaces","volumeCoffreLitres","boite","carburant","climatisation",
    "cylindreeCc","puissanceCh","typeMoto","permisRequis",
    "volumeM3"
  ].forEach(id => $(id).addEventListener("input", updatePreview));

  $("btnAdd").addEventListener("click", () => callApi("POST"));
  $("btnUpdate").addEventListener("click", () => callApi("PUT"));
  $("btnDelete").addEventListener("click", () => callApi("DELETE"));

  showFields();
  updatePreview();
</script>
</body>
</html>
