<!doctype html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/layout :: layout('Catalogue', ~{::section})}">

<section>
  <div class="panel soft">
    <div class="panel-head">
      <div>
        <h1 class="h1">Catalogue</h1>
        <div class="muted small">
          Date de référence : <strong th:text="${filtreDate}">2026-01-01</strong>
        </div>
      </div>

      <div class="btnrow">
        <a class="btn" th:classappend="${filtreVehicule} ? 'primary' : ''"
           th:href="@{/louables(vehicule=${true}, prixMax=${filtrePrixMax}, date=${filtreDate}, uniquementDisponibles=${filtreUniquementDisponibles})}">
           Véhicules
        </a>
        <a class="btn" th:classappend="${!filtreVehicule} ? 'primary' : ''"
           th:href="@{/louables(vehicule=${false}, prixMax=${filtrePrixMax}, date=${filtreDate}, uniquementDisponibles=${filtreUniquementDisponibles})}">
           Louables
        </a>
      </div>
    </div>

    <div class="hr"></div>

    <form class="form" method="get" th:action="@{/louables}">
      <input type="hidden" name="vehicule" th:value="${filtreVehicule}" />

      <div class="row">
        <div class="col field">
          <div class="label">Prix max (€ / jour)</div>
          <input class="input" type="number" step="0.01" name="prixMax"
                 th:value="${filtrePrixMax}" placeholder="Ex: 50" />
        </div>

        <div class="col field">
          <div class="label">Date cible</div>
          <input class="input" type="date" name="date"
                 th:value="${filtreDate}" />
        </div>

        <div class="col field" style="display: flex; align-items: center; padding-top: 25px;">
           <label style="cursor: pointer;">
             <input type="checkbox" name="uniquementDisponibles" value="true"
                    th:checked="${filtreUniquementDisponibles}" />
             Uniquement disponibles
           </label>
        </div>
      </div>

      <div class="btnrow">
        <button class="btn primary" type="submit">Filtrer</button>
        <a class="btn ghost" th:href="@{/louables(vehicule=${filtreVehicule})}">Réinitialiser</a>
      </div>
    </form>
  </div>

  <div class="spacer"></div>

  <div th:if="${filtreVehicule}">
    <div class="grid" th:if="${vehicules != null and !vehicules.isEmpty()}">
      <article class="card" th:each="v : ${vehicules}">
        <div class="panel-head">
          <div>
            <span class="badge cyan" th:text="${v.type()}">Vehicule</span>
            
            <div class="card-title" th:text="${v.marque()} + ' ' + ${v.modele()}">Marque Modèle</div>
            
            <div class="muted small">
              <span th:text="${v.annee()}">2020</span>
              · <span th:text="${v.couleur()}">Noir</span>
              · <span th:text="${v.kilometrage()} + ' km'">0 km</span>
            </div>
          </div>

          <div class="text-right">
            <div class="badge"
                 th:classappend="${v.louable().disponibleAujourdhui()} ? ' green' : ' red'"
                 th:text="${v.louable().disponibleAujourdhui()} ? 'DISPONIBLE' : 'INDISPONIBLE'">
              DISPONIBLE
            </div>
            
            <div class="spacer"></div>
            <div class="h3" style="margin:0;" th:text="${v.louable().prixJour()} + ' € / jour'">0 € / jour</div>
            <div class="muted small" th:text="${v.louable().lieuPrincipal()}">Lieu</div>

            <div class="spacer"></div>
            <div class="muted small"
                 th:if="${moyennesNotes != null and moyennesNotes.get(v.louable().idLouable()) != null}">
                 <span th:text="${'⭐ ' + #numbers.formatDecimal(moyennesNotes.get(v.louable().idLouable()), 1, 1) + ' / 5'}">⭐ 4.5 / 5</span>
            </div>
            <div class="muted small"
                 th:if="${moyennesNotes == null or moyennesNotes.get(v.louable().idLouable()) == null}">
                 ⭐ Aucune note
            </div>
          </div>
        </div>

        <div class="hr"></div>

        <div class="btnrow">
          <a class="btn primary" th:href="@{/louables/{id}(id=${v.louable().idLouable()})}">Voir</a>
          <a class="btn"
             th:href="@{/louables/{id}/louer(id=${v.louable().idLouable()})}"
             th:if="${v.louable().disponibleAujourdhui()}">
            Louer
          </a>
        </div>
      </article>
    </div>

    <div class="alert warn" th:if="${vehicules == null or vehicules.isEmpty()}">
      Aucun véhicule ne correspond à vos critères.
    </div>
  </div>

  <div th:if="${!filtreVehicule}">
    <div class="grid" th:if="${louables != null and !louables.isEmpty()}">
      <article class="card" th:each="l : ${louables}">
        <div class="panel-head">
          <div>
            <span class="badge magenta" th:text="${l.type()}">Louable</span>
            <div class="card-title" th:text="'Louable #' + ${l.idLouable()}">Louable #</div>
            <div class="muted small">
              Statut base : <strong th:text="${l.statut()}">OK</strong>
            </div>
          </div>

          <div class="text-right">
            <div class="badge"
                 th:classappend="${l.disponibleAujourdhui()} ? ' green' : ' red'"
                 th:text="${l.disponibleAujourdhui()} ? 'DISPONIBLE' : 'INDISPONIBLE'">
              DISPONIBLE
            </div>
            
            <div class="spacer"></div>
            <div class="h3" style="margin:0;" th:text="${l.prixJour()} + ' € / jour'">0 € / jour</div>
            <div class="muted small" th:text="${l.lieuPrincipal()}">Lieu</div>

            <div class="spacer"></div>
            <div class="muted small"
                 th:if="${moyennesNotes != null and moyennesNotes.get(l.idLouable()) != null}">
                 <span th:text="${'⭐ ' + #numbers.formatDecimal(moyennesNotes.get(l.idLouable()), 1, 1) + ' / 5'}">⭐ 4.5 / 5</span>
            </div>
            <div class="muted small"
                 th:if="${moyennesNotes == null or moyennesNotes.get(l.idLouable()) == null}">
                 ⭐ Aucune note
            </div>
          </div>
        </div>

        <div class="hr"></div>

        <div class="btnrow">
          <a class="btn primary" th:href="@{/louables/{id}(id=${l.idLouable()})}">Voir</a>
          <a class="btn"
             th:href="@{/louables/{id}/louer(id=${l.idLouable()})}"
             th:if="${l.disponibleAujourdhui()}">
            Louer
          </a>
        </div>
      </article>
    </div>

    <div class="alert warn" th:if="${louables == null or louables.isEmpty()}">
      Aucun louable ne correspond à vos critères.
    </div>
  </div>

</section>
</html>